<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>來點蘇打綠ᐠ( ᐛ )ᐟ</title>
    <style>
        /* 原始 CSS 框架 */
        body {
            font-family: '微軟正黑體', 'Microsoft JhengHei', sans-serif;
            background-color: #f0f0e8; 
            color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            min-height: 100vh;
            margin: 0;
            line-height: 1.8;
        }

        #container {
            background-color: #fff;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            max-width: 800px;
            width: 90%;
            text-align: center;
        }

        #generateBtn {
            background-color: #4CAF50; 
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 30px;
            transition: background-color 0.3s;
        }

        #generateBtn:hover {
            background-color: #45a049;
        }

        #lyricOutput {
            margin-top: 30px;
            min-height: 150px; 
        }

        #lyricText {
            font-size: 28px;
            font-weight: bold;
            color: #008080; 
            margin-bottom: 15px;
            opacity: 0;
            transition: opacity 0.5s;
        }
        
        #songTitle {
            font-size: 18px;
            color: #777;
            opacity: 0;
            transition: opacity 0.5s;
        }

        /* YouTube 嵌入區塊樣式 */
        #videoContainer {
            width: 100%;
            max-width: 560px;
            margin: 20px auto 0;
            aspect-ratio: 16 / 9; 
            overflow: hidden;
            display: none; 
        }

        #youtubePlayer {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
    </style>
</head>
<body>

    <div id="container">
        <h1>來點蘇打綠ᐠ( ᐛ )ᐟ</h1>
        <p>按下按鈕，讓音樂唱出此刻的註解。</p>

        <button id="generateBtn">抽取！</button>

        <div id="lyricOutput">
            <div id="lyricText">點擊抽取按鈕開始...</div>
            <div id="songTitle"></div>
        </div>

        <hr style="width: 50%; border-top: 1px dashed #ccc;">

        <div id="videoContainer">
            <iframe id="youtubePlayer" allow="autoplay; encrypted-media" allowfullscreen></iframe>
        </div>
    </div> <footer style="margin-top: 40px; padding: 20px; text-align: center; font-size: 14px; color: #666; border-top: 1px solid #eee;">
        
        <p style="margin-bottom: 5px; font-weight: bold; color: #4CAF50;">
            【非官方版權聲明】
        </p>
        <p style="line-height: 1.5; margin-bottom: 10px;">
            本網站為個人專案，純屬非營利目的之粉絲分享與程式設計學習交流，<br>
            與蘇打綠（Sodagreen）及其所屬唱片公司或相關版權方無任何關係。
        </p>
        <p>
            所有歌詞、音樂與影像素材之版權（Copyright）及智慧財產權，<br>
            完全歸屬於原創作者及所屬版權公司所有。
            本站不持有任何相關權利。
        </p>
        
        <p style="margin-top: 15px;">
            <a href="https://github.com/mistyflow66/a-cup-of-sodagreen" target="_blank" style="color: #4CAF50;">GitHub專案頁面</a> | 
            <a href="https://forms.gle/rymboVNNjuKu48729" target="_blank" style="color: #4CAF50;">歌詞表單</a>
        </p>
    </footer>


    <script>
        // Apps Script網址
        const APP_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzLekd2g5tj51Wh9nnH5xEPQdNMctLUj0np2Xlhz_EY6BkqOI8uhcejQDNlkDJ22u4A/exec'; 
        
        let allLyricsData = [];
        
        // --- 輔助函式：從 YouTube URL 中提取 ID ---
        function extractYouTubeID(url) {
            if (!url) return null;
            // 匹配 v=, youtu.be/, 或 embed/ 後的 11 位字元
            const regex = /(?:v=|youtu\.be\/|embed\/)([^&?#/]+)/;
            const match = url.match(regex);
            
            if (match && match[1].length === 11) {
                return match[1];
            }
            return null;
        }

        // --- 主邏輯：讀取資料並更新網頁 ---
        async function loadAndGenerateLyric() {
            const lyricTextEl = document.getElementById('lyricText');
            const songTitleEl = document.getElementById('songTitle');
            const videoContainerEl = document.getElementById('videoContainer');
            const youtubePlayerEl = document.getElementById('youtubePlayer');

            // 1. 載入資料 (只在第一次點擊或載入時執行)
            if (allLyricsData.length === 0) {
                lyricTextEl.textContent = '資料載入中，請稍候...';
                
                try {
                    // 使用 fetch 讀取 Apps Script 提供的 JSON
                    const response = await fetch(APP_SCRIPT_URL);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP 錯誤! 狀態碼: ${response.status}`);
                    }
                    
                    allLyricsData = await response.json();
                    
                    if (allLyricsData.length === 0) {
                        lyricTextEl.textContent = '錯誤：試算表中沒有找到任何歌詞資料。';
                        return;
                    }
                } catch (error) {
                    console.error('讀取 Apps Script 錯誤:', error);
                    lyricTextEl.textContent = '抱歉，無法載入歌詞。請確認 Apps Script 網址與部署是否正確。';
                    return;
                }
            }

            // 2. 隨機抽取一筆資料
            const randomIndex = Math.floor(Math.random() * allLyricsData.length);
            const item = allLyricsData[randomIndex];
            
            // 3. 更新歌詞 (使用中文鍵名：'歌詞' 和 '歌名')
            lyricTextEl.style.opacity = '0';
            songTitleEl.style.opacity = '0';

            setTimeout(() => {
                lyricTextEl.textContent = item['歌詞'];
                songTitleEl.textContent = `- ${item['歌名']} -`;
                lyricTextEl.style.opacity = '1';
                songTitleEl.style.opacity = '1';
            }, 100); 

            // 4. 處理 MV 嵌入 (使用中文鍵名：'網址' 和 '起始秒數')
const youtubeID = extractYouTubeID(item['網址']);

if (youtubeID) {
    let iframeSrc = `https://www.youtube-nocookie.com/embed/${youtubeID}?enablejsapi=1&autoplay=1&rel=0`; 
    
    if (item['起始秒數（選填）'] && item['起始秒數（選填）'] > 0) {
        iframeSrc += `&start=${item['起始秒數（選填）']}`;
    }

    youtubePlayerEl.src = iframeSrc;
    videoContainerEl.style.display = 'block';
} else {
    youtubePlayerEl.src = '';
    videoContainerEl.style.display = 'none';
}
        }

        // 綁定按鈕和頁面載入
        document.getElementById('generateBtn').addEventListener('click', loadAndGenerateLyric);
        
        // 頁面載入時首次運行
        window.onload = loadAndGenerateLyric; 
    </script>
</body>
</html>

