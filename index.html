<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¾†é»è˜‡æ‰“ç¶ á ( á› )áŸ</title>
    <style>
        /* åŸå§‹ CSS æ¡†æ¶ */
        body {
            font-family: 'å¾®è»Ÿæ­£é»‘é«”', 'Microsoft JhengHei', sans-serif;
            background-color: #f0f0e8; 
            color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            min-height: 100vh;
            margin: 0;
            line-height: 1.8;
        }

        #container {
            background-color: #fff;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            max-width: 800px;
            width: 90%;
            text-align: center;
        }

        #generateBtn {
            background-color: #4CAF50; 
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 30px;
            transition: background-color 0.3s;
        }

        #generateBtn:hover {
            background-color: #45a049;
        }

        #lyricOutput {
            margin-top: 30px;
            min-height: 150px; 
        }

        #lyricText {
            font-size: 28px;
            font-weight: bold;
            color: #008080; 
            margin-bottom: 15px;
            opacity: 0;
            transition: opacity 0.5s;
        }
        
        #lyricText.loading {
    font-size: 20px !important;  /* è¼‰å…¥æ™‚è®Šå° */
    color: #666 !important;
        }
        
        #songTitle {
            font-size: 18px;
            color: #777;
            opacity: 0;
            transition: opacity 0.5s;
        }

        /* YouTube åµŒå…¥å€å¡Šæ¨£å¼ */
        #videoContainer {
            width: 100%;
            max-width: 560px;
            margin: 20px auto 0;
            aspect-ratio: 16 / 9; 
            overflow: hidden;
            display: none; 
        }

        #youtubePlayer {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
    </style>
</head>
<body>

    <div id="container">
        <h1>ä¾†é»è˜‡æ‰“ç¶ á ( á› )áŸ</h1>
        <p>æŒ‰ä¸‹æŒ‰éˆ•ï¼Œè®“éŸ³æ¨‚ç‚ºä½ å”±å‡ºæ­¤åˆ»çš„è¨»è§£ã€‚</p>

        <button id="generateBtn">æŠ½å–ï¼</button>

        <div id="lyricOutput">
            <div id="lyricText">é»æ“ŠæŠ½å–æŒ‰éˆ•é–‹å§‹...</div>
            <div id="songTitle"></div>
        </div>

        <hr style="width: 50%; border-top: 1px dashed #ccc;">

        <div id="videoContainer">
            <iframe id="youtubePlayer" allow="autoplay; encrypted-media" allowfullscreen></iframe>
        </div>
    </div> <footer style="margin-top: 40px; padding: 20px; text-align: center; font-size: 14px; color: #666; border-top: 1px solid #eee;">
        
        <p style="margin-bottom: 5px; font-weight: bold; color: #4CAF50;">
            ã€éå®˜æ–¹ç‰ˆæ¬Šè²æ˜ã€‘
        </p>
        <p style="line-height: 1.5; margin-bottom: 10px;">
            æœ¬ç¶²ç«™ç‚ºå€‹äººå°ˆæ¡ˆï¼Œç´”å±¬éç‡Ÿåˆ©ç›®çš„ä¹‹ç²‰çµ²åˆ†äº«èˆ‡ç¨‹å¼è¨­è¨ˆå­¸ç¿’äº¤æµï¼Œ<br>
            èˆ‡è˜‡æ‰“ç¶ ï¼ˆSodagreenï¼‰åŠå…¶æ‰€å±¬å”±ç‰‡å…¬å¸æˆ–ç›¸é—œç‰ˆæ¬Šæ–¹ç„¡ä»»ä½•é—œä¿‚ã€‚
        </p>
        <p>
            æ‰€æœ‰æ­Œè©ã€éŸ³æ¨‚èˆ‡å½±åƒç´ æä¹‹ç‰ˆæ¬Šï¼ˆCopyrightï¼‰åŠæ™ºæ…§è²¡ç”¢æ¬Šï¼Œ<br>
            å®Œå…¨æ­¸å±¬æ–¼åŸå‰µä½œè€…åŠæ‰€å±¬ç‰ˆæ¬Šå…¬å¸æ‰€æœ‰ã€‚
            æœ¬ç«™ä¸æŒæœ‰ä»»ä½•ç›¸é—œæ¬Šåˆ©ã€‚
        </p>
        
        <p style="margin-top: 15px;">
            <a href="https://github.com/mistyflow66/a-cup-of-sodagreen" target="_blank" style="color: #4CAF50;">GitHubå°ˆæ¡ˆé é¢</a> | 
            <a href="https://forms.gle/rymboVNNjuKu48729" target="_blank" style="color: #4CAF50;">æ­Œè©è¡¨å–®</a>
        </p>
    </footer>


    <script>
        // Apps Scriptç¶²å€
        const APP_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzLekd2g5tj51Wh9nnH5xEPQdNMctLUj0np2Xlhz_EY6BkqOI8uhcejQDNlkDJ22u4A/exec'; 
        
        let allLyricsData = [];
        
        // --- è¼”åŠ©å‡½å¼ï¼šå¾ YouTube URL ä¸­æå– ID ---
        function extractYouTubeID(url) {
            if (!url) return null;
            // åŒ¹é… v=, youtu.be/, æˆ– embed/ å¾Œçš„ 11 ä½å­—å…ƒ
            const regex = /(?:v=|youtu\.be\/|embed\/)([^&?#/]+)/;
            const match = url.match(regex);
            
            if (match && match[1].length === 11) {
                return match[1];
            }
            return null;
        }

        // --- ä¸»é‚è¼¯ï¼šè®€å–è³‡æ–™ä¸¦æ›´æ–°ç¶²é  ---
        async function loadAndGenerateLyric() {
            const lyricTextEl = document.getElementById('lyricText');
            const songTitleEl = document.getElementById('songTitle');
            const videoContainerEl = document.getElementById('videoContainer');
            const youtubePlayerEl = document.getElementById('youtubePlayer');

            // 1. è¼‰å…¥è³‡æ–™ (åªåœ¨ç¬¬ä¸€æ¬¡é»æ“Šæˆ–è¼‰å…¥æ™‚åŸ·è¡Œ)
            if (allLyricsData.length === 0) {
                lyricTextEl.textContent = 'ğŸµè¼‰å…¥ä¸­ï¼Œè«‹ç¨å€™...';
                lyricTextEl.style.opacity = '1'
                    lyricTextEl.classList.add('loading');
                
                try {
                    // ä½¿ç”¨ fetch è®€å– Apps Script æä¾›çš„ JSON
                    const response = await fetch(APP_SCRIPT_URL);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP éŒ¯èª¤! ç‹€æ…‹ç¢¼: ${response.status}`);
                    }
                    
                    allLyricsData = await response.json();
                    
                    if (allLyricsData.length === 0) {
                        lyricTextEl.textContent = 'éŒ¯èª¤ï¼šè©¦ç®—è¡¨ä¸­æ²’æœ‰æ‰¾åˆ°ä»»ä½•æ­Œè©è³‡æ–™ã€‚';
                        return;
                    }
                } catch (error) {
                    console.error('è®€å– Apps Script éŒ¯èª¤:', error);
                    lyricTextEl.textContent = 'æŠ±æ­‰ï¼Œç„¡æ³•è¼‰å…¥æ­Œè©ã€‚è«‹ç¢ºèª Apps Script ç¶²å€èˆ‡éƒ¨ç½²æ˜¯å¦æ­£ç¢ºã€‚';
                    return;
                }
            }

            // 2. éš¨æ©ŸæŠ½å–ä¸€ç­†è³‡æ–™
            const randomIndex = Math.floor(Math.random() * allLyricsData.length);
            const item = allLyricsData[randomIndex];
            
            // 3. æ›´æ–°æ­Œè© (ä½¿ç”¨ä¸­æ–‡éµåï¼š'æ­Œè©' å’Œ 'æ­Œå')
            lyricTextEl.style.opacity = '0';
            songTitleEl.style.opacity = '0';
            lyricTextEl.classList.remove('loading');  

            setTimeout(() => {
                lyricTextEl.textContent = item['æ­Œè©'];
                songTitleEl.textContent = `- ${item['æ­Œå']} -`;
                lyricTextEl.style.opacity = '1';
                songTitleEl.style.opacity = '1';
            }, 100); 

            // 4. è™•ç† MV åµŒå…¥ (ä½¿ç”¨ä¸­æ–‡éµåï¼š'ç¶²å€' å’Œ 'èµ·å§‹ç§’æ•¸')
const youtubeID = extractYouTubeID(item['ç¶²å€']);

if (youtubeID) {
    let iframeSrc = `https://www.youtube-nocookie.com/embed/${youtubeID}?enablejsapi=1&autoplay=1&rel=0`; 
    
    if (item['èµ·å§‹ç§’æ•¸ï¼ˆé¸å¡«ï¼‰'] && item['èµ·å§‹ç§’æ•¸ï¼ˆé¸å¡«ï¼‰'] > 0) {
        iframeSrc += `&start=${item['èµ·å§‹ç§’æ•¸ï¼ˆé¸å¡«ï¼‰']}`;
    }

    youtubePlayerEl.src = iframeSrc;
    videoContainerEl.style.display = 'block';
} else {
    youtubePlayerEl.src = '';
    videoContainerEl.style.display = 'none';
}
        }

        // ç¶å®šæŒ‰éˆ•å’Œé é¢è¼‰å…¥
        document.getElementById('generateBtn').addEventListener('click', loadAndGenerateLyric);
        
        // ç§»é™¤é é¢è¼‰å…¥æ™‚é¦–æ¬¡é‹è¡Œwindow.onload = loadAndGenerateLyric
        
    </script>
</body>
</html>





